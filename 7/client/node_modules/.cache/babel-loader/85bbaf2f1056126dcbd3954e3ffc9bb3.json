{"ast":null,"code":"import _regeneratorRuntime from \"C:\\\\\\u041F\\u0440\\u043E\\u0433\\u0440\\u0430\\u043C\\u043C\\u0438\\u0440\\u043E\\u0432\\u0430\\u043D\\u0438\\u0435\\\\node\\\\7\\\\client\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/regenerator\";\n\nvar _marked =\n/*#__PURE__*/\n_regeneratorRuntime.mark(signInSaga),\n    _marked2 =\n/*#__PURE__*/\n_regeneratorRuntime.mark(saga);\n\nimport { appName } from '../../config';\nimport { createSelector } from 'reselect';\nimport { Record, OrderedMap, List } from 'immutable';\nimport { call, put, takeEvery, all, select } from 'redux-saga/effects';\nimport { replace } from 'connected-react-router';\nimport jwt from 'jwt-decode';\nimport { UserAuthEntity } from './entity/auth-entity';\nimport Api from '../../helpers/api';\nimport errorAction from '../../helpers/error';\nimport LocalStorage from '../../helpers/local-storage';\n/*\r\n*   Contstants \r\n*/\n\nexport var moduleName = 'auth';\nvar prefix = \"\".concat(appName, \"/\").concat(moduleName);\nexport var SIGN_IN_REQUEST = \"\".concat(prefix, \"/SIGN_IN_REQUEST\");\nexport var SIGN_IN_SUCCESS = \"\".concat(prefix, \"/SIGN_IN_SUCCESS\");\n/*\r\n*   Reducer\r\n*/\n\nexport var ReducerRecord = Record({\n  access_token: null,\n  user: null\n});\nexport default function reducer() {\n  var state = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : new ReducerRecord();\n  var action = arguments.length > 1 ? arguments[1] : undefined;\n  var type = action.type,\n      payload = action.payload;\n\n  switch (type) {\n    case SIGN_IN_SUCCESS:\n      return state.se;\n\n    default:\n      return state;\n  }\n}\n/*\r\n*   Selectors\r\n*/\n\nexport var stateSelector = function stateSelector(state) {\n  return state[moduleName];\n};\nexport var userSelector = createSelector(stateSelector, function (state) {\n  return state.user;\n});\nexport var isAuthorizeSelector = createSelector(userSelector, function (user) {\n  return !!user;\n});\n/*\r\n*   Action Creaters\r\n*/\n\nexport function signIn(username, password) {\n  return {\n    type: SIGN_IN_REQUEST,\n    payload: {\n      username: username,\n      password: password\n    }\n  };\n}\n/*\r\n*   Sagas\r\n*/\n\nexport function signInSaga(_ref) {\n  var payload, username, password, _ref2, error, result, _jwt, user;\n\n  return _regeneratorRuntime.wrap(function signInSaga$(_context) {\n    while (1) {\n      switch (_context.prev = _context.next) {\n        case 0:\n          payload = _ref.payload;\n          username = payload.username, password = payload.password;\n          _context.next = 4;\n          return call(Api.Post, 'auth', {\n            username: username,\n            password: password\n          });\n\n        case 4:\n          _ref2 = _context.sent;\n          error = _ref2.error;\n          result = _ref2.result;\n\n          if (!error) {\n            _context.next = 9;\n            break;\n          }\n\n          return _context.abrupt(\"return\", errorAction(error));\n\n        case 9:\n          _jwt = jwt(result.access_token), user = _jwt.user;\n          _context.next = 12;\n          return put({\n            type: SIGN_IN_SUCCESS,\n            payload: {\n              user: user,\n              access_token: result.access_token\n            }\n          });\n\n        case 12:\n          LocalStorage.setObjectToStorage(result.refresh_token, 'refresh_token');\n\n        case 13:\n        case \"end\":\n          return _context.stop();\n      }\n    }\n  }, _marked);\n}\nexport function saga() {\n  return _regeneratorRuntime.wrap(function saga$(_context2) {\n    while (1) {\n      switch (_context2.prev = _context2.next) {\n        case 0:\n          _context2.next = 2;\n          return all([takeEvery(SIGN_IN_REQUEST, signInSaga)]);\n\n        case 2:\n        case \"end\":\n          return _context2.stop();\n      }\n    }\n  }, _marked2);\n}","map":{"version":3,"sources":["C:/Программирование/node/7/client/src/ducks/auth/index.js"],"names":["signInSaga","saga","appName","createSelector","Record","OrderedMap","List","call","put","takeEvery","all","select","replace","jwt","UserAuthEntity","Api","errorAction","LocalStorage","moduleName","prefix","SIGN_IN_REQUEST","SIGN_IN_SUCCESS","ReducerRecord","access_token","user","reducer","state","action","type","payload","se","stateSelector","userSelector","isAuthorizeSelector","signIn","username","password","Post","error","result","setObjectToStorage","refresh_token"],"mappings":"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","sourcesContent":["import { appName } from '../../config'\r\nimport { createSelector } from 'reselect'\r\nimport { Record, OrderedMap, List } from 'immutable'\r\nimport { call, put, takeEvery, all, select } from 'redux-saga/effects'\r\nimport { replace } from 'connected-react-router'\r\nimport jwt from 'jwt-decode'\r\n\r\nimport { UserAuthEntity } from './entity/auth-entity'\r\nimport Api from '../../helpers/api'\r\nimport errorAction from '../../helpers/error'\r\nimport LocalStorage from '../../helpers/local-storage'\r\n\r\n/*\r\n*   Contstants \r\n*/\r\n\r\nexport const moduleName = 'auth'\r\n\r\nconst prefix = `${appName}/${moduleName}`\r\n\r\nexport const SIGN_IN_REQUEST = `${prefix}/SIGN_IN_REQUEST`\r\nexport const SIGN_IN_SUCCESS = `${prefix}/SIGN_IN_SUCCESS`\r\n\r\n/*\r\n*   Reducer\r\n*/\r\n\r\nexport const ReducerRecord = Record({\r\n    access_token: null,\r\n    user: null\r\n})\r\n\r\nexport default function reducer(state = new ReducerRecord(), action) {\r\n    const { type, payload } = action\r\n\r\n    switch (type) {\r\n\r\n        case SIGN_IN_SUCCESS: \r\n            return state\r\n                .se\r\n\r\n        default: \r\n            return state\r\n \r\n    }\r\n}\r\n\r\n/*\r\n*   Selectors\r\n*/\r\n\r\nexport const stateSelector = (state) => state[moduleName]\r\nexport const userSelector = createSelector(stateSelector, state => state.user)\r\n\r\nexport const isAuthorizeSelector = createSelector(\r\n    userSelector,\r\n    (user) => !!user\r\n)\r\n\r\n/*\r\n*   Action Creaters\r\n*/\r\n\r\nexport function signIn(username, password) {\r\n    return {\r\n        type: SIGN_IN_REQUEST,\r\n        payload: { username, password }\r\n    }\r\n}\r\n\r\n/*\r\n*   Sagas\r\n*/\r\n\r\nexport function* signInSaga({payload}) {\r\n\r\n    const {username, password} = payload\r\n    const { error, result } = yield call(Api.Post, 'auth', {username, password})\r\n    \r\n    if(error) \r\n        return errorAction(error)\r\n\r\n    const { user } = jwt(result.access_token)\r\n\r\n    yield put({\r\n        type: SIGN_IN_SUCCESS,\r\n        payload: { user, access_token: result.access_token }\r\n    })\r\n\r\n    LocalStorage.setObjectToStorage(result.refresh_token, 'refresh_token')\r\n}\r\n\r\nexport function* saga() {\r\n    yield all([\r\n        takeEvery(SIGN_IN_REQUEST, signInSaga),\r\n    ])\r\n}"]},"metadata":{},"sourceType":"module"}